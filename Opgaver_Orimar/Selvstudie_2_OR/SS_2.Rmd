---
title: "miniprojekt_2"
output:
  pdf_document:
    extra_dependencies: ["float"]
    toc: true
    toc_depth: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
Sys.setenv(language = "en")
library(sde)
library(tidyverse)
```

# Exercise 1.

## 1.

```{r}

sim_BM <- function(T_, delta) {
  if (delta==0) {
    return(0)
  } else
  tmesh <- seq(from = 0, to = T_, by = delta)
  N <- length(tmesh)
  Norm <- rnorm(N)
  B <- c(0, cumsum(sqrt(delta) * Norm[-N]))
  return(B)
}

b <- function(x) {
  matrix(c(
    0,
    0.5 - (0.5 + 0) * x[2]
  ), nrow = 2, ncol = 1)
}

sigma <- function(x) {
  matrix(c(
    x[1] * sqrt(1),
    0, 0, 0.4
  ), nrow = 2, ncol = 2) * sqrt(x[2])
}

payoff <- function(x, K) {
  max(x[, 1] - K, 0)
}

algo_1 <- function(M, n, t, T, r, b, sigma, x, payoff, K) {
  delta_n <- (T - t) / n
  last_obs <- matrix(0, nrow = M, ncol = 2)
  for (j in 1:M) {
    bm1 <- diff(sim_BM(T_ = 1, delta = delta_n))
    bm2 <- diff(sim_BM(T_ = 1, delta = delta_n))
    bm <- cbind(bm1, bm2)
    X <- matrix(x, nrow = n + 1, ncol = 2, byrow = TRUE)
    for (k in 2:n) {
      X[k + 1, ] <- X[k, ] + delta_n * b(X[k, ]) + sigma(X[k, ]) %*% bm[k, ]
    }
    last_obs[j, ] <- X[n, ]
  }
  F <- exp(-r * (T - t)) * 1 / M * sum(payoff(last_obs, K))
  return(F)
}

# algo_1(M = 100, n = 100, t = 0.1, T = 1, r = 0, b = b, sigma = sigma, x = c(9, 0.1), payoff = payoff, K = 10)


Heston_euler_payoff <- function(n_, m_, q_, x_min, x_max, v_min, v_max, T, K) {
  delta_n_time <- T / n_
  delta_m_price <- (x_max - x_min) / m_
  delta_q_vol <- (v_max - v_min) / q_
  t <- delta_n_time * 0:n_
  x <- x_min + 0:m_ * delta_m_price
  v <- v_min + delta_q_vol * 0:q_

  result <- matrix(data = NA,nrow = (n_+1)*(m_+1)*(q_+1),
                   ncol = 4,dimnames = list(c(),c("t", "si", "y", "price")))
  i <- 1
  for (t_ in t) {
    for (si_ in x) {
      for (y_ in v) {
        result[i, c("t", "si", "y", "price")] <- c(
          t_, si_, y_,
          algo_1(
            M = 10, # monte carlo sims
            n = n_,
            t = t_, T = T, r = 0, b = b, sigma = sigma, x = c(si_, y_), payoff = payoff, K = K
          )
        )
        i <- i + 1
      }
    }
  }
}

ex_2 <- Heston_euler_payoff(100, 10, 10, 0, 10, 0, 10, 1, 1)
```

## 2.

```{r}

```

## 3.

```{r}

```

## 4.

```{r}

```


## 5.

```{r}

```


## 6.

```{r}

```


## 7.

```{r}


```


## 8.


# Exercise 2.

## 1.

```{r}

```


## 2.

```{r}

```


## 3.

```{r}

```
